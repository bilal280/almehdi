# تحديث منهجية الاختبارات

## نظرة عامة
تم تحديث نظام الاختبارات ليتوافق مع المنهجية الجديدة التي تميز بين ثلاثة مستويات من الطلاب: التمهيدي، التلاوة، والحفاظ.

## التغييرات الرئيسية

### 1. واجهة المستخدم
- **خطوة اختيار الطالب**: يتم أولاً اختيار الحلقة والطالب، ثم الضغط على زر "إدخال الاختبار"
- **نموذج ديناميكي**: يتغير النموذج تلقائياً بناءً على مستوى الطالب المختار
- **عرض معلومات الطالب**: يظهر اسم الطالب ومستواه في أعلى نموذج الاختبار

### 2. مستوى التمهيدي
#### الحقول المطلوبة:
- **المرحلة** (إلزامي): اختيار من:
  - مرحلة الحروف
  - مرحلة الحركات
  - مرحلة السكون
  - مرحلة الشدة
  - مرحلة التنوين
  - مرحلة همزة الوصل
  - مرحلة كامل
  - أخرى

#### الحقول الاختيارية:
- العلامة
- التقييم (ممتاز، جيد جداً، جيد، مقبول، ضعيف)
- علامة التجويد النظري (من 10)
- علامة حفظ السور (من 10)
- رقم المحاولة (1-4)
- ملاحظات

### 3. مستوى التلاوة
#### الحقول المطلوبة:
- **القسم** (إلزامي): اختيار من:
  - الأجزاء من 1 إلى 30
  - مرحلة العشرة
  - مرحلة العشرين
  - مرحلة الكامل
  - الحزب 57، 58، 59، 60 (آخر 4 أحزاب)
  - عم وتبارك

#### الحقول الاختيارية:
- العلامة
- التقييم
- علامة التجويد النظري (من 10)
- علامة حفظ السور (من 10)
- **علامة التفسير (من 10)** - خاص بالتلاوة
- رقم المحاولة (1-4)
- ملاحظات

### 4. مستوى الحفاظ
#### الحقول المطلوبة:
- **القسم** (إلزامي): اختيار من:
  - الأجزاء من 1 إلى 30
  - مرحلة الخمسة (كل 5 أجزاء)
  - مرحلة العشرة
  - مرحلة الخمسة عشر
  - مرحلة العشرين
  - مرحلة الخمسة والعشرين
  - مرحلة الكامل
  - عم وتبارك

#### الحقول الاختيارية:
- العلامة
- التقييم
- علامة التجويد النظري (من 10)
- علامة حفظ السور (من 10)
- **علامة الثبات (من 10)** - خاص بالحفاظ
- رقم المحاولة (1-4)
- ملاحظات

## التغييرات في قاعدة البيانات

### الحقول الجديدة في جدول `student_exams`:
1. `tamhidi_stage` - مرحلة التمهيدي
2. `tilawah_section` - قسم التلاوة
3. `hifd_section` - قسم الحفاظ
4. `stability_score` - علامة الثبات (للحفاظ)
5. `surah_memory_score` - علامة حفظ السور (مشترك)

### التعديلات:
- تم تعديل `attempt_number` ليسمح بـ 4 محاولات بدلاً من 3
- تم جعل `juz_number` اختيارياً للتوافق مع النظام الجديد
- تم إضافة قيود فريدة (unique constraints) لكل مستوى

## كيفية تطبيق التحديثات

### 1. تطبيق الهجرة على قاعدة البيانات:
قم بتشغيل ملف الهجرة الموجود في:
```
supabase/migrations/20251128000000_update_exams_methodology.sql
```

يمكنك تطبيقه يدوياً من خلال:
- Supabase Dashboard → SQL Editor
- أو باستخدام Supabase CLI: `supabase db push`

### 2. التحقق من التحديثات:
- تأكد من أن جميع الحقول الجديدة تم إضافتها بنجاح
- تحقق من أن القيود (constraints) تعمل بشكل صحيح

## ملاحظات مهمة

1. **البيانات القديمة**: البيانات الموجودة في الجدول لن تتأثر، حيث أن الحقول الجديدة اختيارية
2. **التوافق**: النظام القديم سيستمر في العمل للبيانات الموجودة
3. **التحقق**: يتم التحقق من اختيار المرحلة/القسم المناسب حسب مستوى الطالب قبل الحفظ
4. **المحاولات**: تم زيادة عدد المحاولات المسموحة من 3 إلى 4
5. **التكرار**: تم إزالة القيود الفريدة، يمكن للطالب اختبار نفس المرحلة/القسم عدة مرات

## التحديثات الإضافية

### 1. تحديث التقييمات
- تم استبدال "ضعيف" بـ "إعادة" في خيارات التقييم

### 2. صفحة سجلات الاختبارات للأدمن
تم تحديث صفحة `AdminExamRecords.tsx` لتشمل:
- عرض المستوى (تمهيدي/تلاوة/حفاظ)
- عرض القسم/المرحلة بدلاً من رقم الجزء فقط
- عرض جميع الحقول الجديدة (التجويد، حفظ السور، التفسير، الثبات)
- زر حذف مع تأكيد قبل الحذف
- تحديث التصدير إلى Excel ليشمل جميع الحقول الجديدة

### 3. تأكيد الحذف
- تم إضافة مربع حوار تأكيد عند محاولة حذف سجل اختبار
- يظهر رسالة تحذيرية: "هل أنت متأكد من حذف سجل الاختبار هذا؟"
- يتطلب تأكيد صريح قبل إتمام عملية الحذف

## الاختبار

للتأكد من أن كل شيء يعمل بشكل صحيح:
1. اختر طالباً من مستوى التمهيدي وتأكد من ظهور خيارات المراحل الصحيحة
2. اختر طالباً من مستوى التلاوة وتأكد من ظهور خيارات الأجزاء والأحزاب
3. اختر طالباً من مستوى الحفاظ وتأكد من ظهور خيارات المراحل الخاصة بالحفظ
4. تأكد من أن جميع الحقول الاختيارية تعمل بشكل صحيح
5. جرب حفظ اختبار لكل مستوى وتأكد من حفظ البيانات بنجاح
6. تحقق من صفحة سجلات الاختبارات وتأكد من عرض البيانات بشكل صحيح
7. جرب حذف سجل اختبار وتأكد من ظهور رسالة التأكيد
