# منطق عرض التاريخ في صفحة الطالب

## التغيير المنفذ

تم تعديل صفحة تقرير الطالب (`DynamicStudentReport.tsx`) لعرض بيانات الأمس تلقائياً إذا دخل الطالب قبل الساعة 5:30 مساءً (بتوقيت مكة المكرمة).

## المنطق الجديد

### دالة `getInitialDate()`

```typescript
const getInitialDate = () => {
  // الحصول على الوقت بتوقيت مكة المكرمة (UTC+3)
  const now = new Date();
  const meccaTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Riyadh' }));
  const hours = meccaTime.getHours();
  const minutes = meccaTime.getMinutes();
  
  // إذا كان الوقت قبل الساعة 5:30 مساءً (17:30), نعرض بيانات الأمس
  if (hours < 17 || (hours === 17 && minutes < 30)) {
    const yesterday = new Date(meccaTime);
    yesterday.setDate(yesterday.getDate() - 1);
    return yesterday.toISOString().split('T')[0];
  }
  
  // بعد الساعة 5:30 مساءً (17:30), نعرض بيانات اليوم
  return meccaTime.toISOString().split('T')[0];
};
```

## التوقيت

- **المنطقة الزمنية**: توقيت مكة المكرمة (Asia/Riyadh - UTC+3)
- **الوقت المرجعي**: 5:30 مساءً (17:30)

## حالات الاستخدام

| الوقت الحالي (بتوقيت مكة) | التاريخ المعروض | السبب |
|---------------------------|-----------------|-------|
| 12:00 صباحاً - 5:29 مساءً | الأمس | قبل بداية الحلقة المسائية |
| 5:30 مساءً - 11:59 مساءً | اليوم | بعد بداية الحلقة المسائية |

## الفوائد

1. **توقيت دقيق**: استخدام توقيت مكة المكرمة (UTC+3) بدلاً من التوقيت المحلي
2. **تجربة مستخدم أفضل**: الطلاب الذين يدخلون قبل المساء يرون بيانات الأمس مباشرة
3. **منطقي للاستخدام**: يتماشى مع أوقات الحلقات المسائية
4. **مرونة**: يمكن للطالب التنقل بين التواريخ بحرية

## مثال عملي

- **السيناريو 1**: طالب يدخل الساعة 3:00 مساءً (بتوقيت مكة)
  - ✅ يرى بيانات الأمس تلقائياً
  - يمكنه التنقل لليوم الحالي إذا أراد

- **السيناريو 2**: طالب يدخل الساعة 8:00 مساءً (بتوقيت مكة)
  - ✅ يرى بيانات اليوم الحالي
  - يمكنه التنقل للأمس إذا أراد

## الملفات المعدلة

- `src/pages/DynamicStudentReport.tsx`

## التاريخ
14 ديسمبر 2024
