# دليل وضع الصيانة

## نظرة عامة
تم إضافة نظام وضع الصيانة الذي يسمح للأدمن بإيقاف صفحات الطلاب مؤقتاً أثناء الصيانة أو التحديثات.

## المميزات

### 1. صفحة إدارة الصيانة (`/admin/maintenance`)
- **التحكم السهل**: مفتاح تبديل بسيط لتفعيل/إيقاف وضع الصيانة
- **الحالة المرئية**: عرض واضح لحالة الصيانة الحالية
- **معلومات شاملة**: شرح تفصيلي لما يحدث عند تفعيل الصيانة

### 2. صفحة الصيانة (`/maintenance`)
- **تصميم احترافي**: واجهة جميلة ومريحة للطلاب
- **رسالة واضحة**: إعلام الطلاب بأن الموقع قيد الصيانة
- **معلومات الاتصال**: إرشادات للاستفسارات الطارئة

### 3. الحماية التلقائية
- **فحص مستمر**: يتم فحص حالة الصيانة كل 5 ثواني
- **إعادة توجيه تلقائية**: يتم توجيه الطلاب تلقائياً لصفحة الصيانة
- **حفظ الصفحة الأصلية**: يتم حفظ رابط صفحة الطالب للعودة إليها
- **عودة تلقائية**: عند إلغاء الصيانة، يعود الطالب لصفحته تلقائياً
- **حماية صفحات الطلاب فقط**: صفحات الأدمن والأساتذة تبقى تعمل

## كيفية الاستخدام

### تفعيل وضع الصيانة:
1. سجل دخول كأدمن
2. اذهب إلى "وضع الصيانة" من القائمة
3. قم بتفعيل المفتاح
4. سيتم إيقاف جميع صفحات الطلاب فوراً

### إيقاف وضع الصيانة:
1. اذهب إلى صفحة "وضع الصيانة"
2. قم بإيقاف المفتاح
3. سيتم تشغيل جميع صفحات الطلاب فوراً

## التفاصيل التقنية

### التخزين
- يتم حفظ حالة الصيانة في `localStorage`
- المفتاح: `maintenanceMode`
- القيم: `'true'` أو `'false'`
- يتم حفظ رابط الصفحة الأصلية في `maintenanceReturnUrl`

### الصفحات المحمية
- `/student/:studentNumber` - صفحات تقارير الطلاب

### الصفحات غير المتأثرة
- جميع صفحات الأدمن (`/admin/*`)
- جميع صفحات الأساتذة (`/teacher/*`)
- صفحات تسجيل الدخول

### المكونات الجديدة

#### 1. `MaintenanceCheck.tsx`
مكون wrapper يفحص حالة الصيانة ويعيد التوجيه إذا لزم الأمر:
```typescript
<MaintenanceCheck>
  <DynamicStudentReport />
</MaintenanceCheck>
```

#### 2. `MaintenancePage.tsx`
صفحة الصيانة التي تظهر للطلاب عند تفعيل الوضع

#### 3. `MaintenanceControl.tsx`
صفحة التحكم في وضع الصيانة للأدمن

## الملفات المعدلة

### 1. `src/App.tsx`
- إضافة مسار `/maintenance`
- إضافة مسار `/admin/maintenance`
- حماية صفحات الطلاب بـ `MaintenanceCheck`

### 2. `src/components/AdminNavbar.tsx`
- إضافة رابط "وضع الصيانة" في القائمة
- نقل "الطلاب المنقطعين" لآخر القائمة

## ملاحظات مهمة

1. **لا يحتاج قاعدة بيانات**: النظام يعمل بالكامل على localStorage
2. **فحص مستمر**: يتم فحص الحالة كل 5 ثواني للطلاب النشطين
3. **سهولة الاستخدام**: تفعيل/إيقاف بضغطة واحدة
4. **آمن**: لا يؤثر على صفحات الإدارة أو الأساتذة

## الاختبار

### لاختبار النظام:
1. افتح صفحة طالب في متصفح (مثلاً `/student/123`)
2. في متصفح آخر، سجل دخول كأدمن
3. فعّل وضع الصيانة
4. انتظر 5 ثواني
5. سيتم توجيه صفحة الطالب تلقائياً لصفحة الصيانة
6. ألغِ وضع الصيانة من صفحة الأدمن
7. انتظر 3 ثواني
8. سيعود الطالب تلقائياً لصفحته الأصلية (`/student/123`)

### للتحقق من localStorage:
```javascript
// في console المتصفح
localStorage.getItem('maintenanceMode')
// يجب أن يعيد 'true' أو 'false'

localStorage.getItem('maintenanceReturnUrl')
// يجب أن يعيد رابط الصفحة الأصلية مثل '/student/123'
```

## الدعم

في حالة وجود أي مشاكل:
1. تأكد من أن localStorage يعمل في المتصفح
2. تحقق من console للأخطاء
3. جرب مسح cache المتصفح
