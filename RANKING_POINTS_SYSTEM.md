# نظام نقاط الترتيب - التوثيق الكامل

## نظرة عامة
نظام النقاط في المشروع يتكون من ثلاثة أنواع:

---

## 1️⃣ نقاط الحماسة (Enthusiasm Points)

### القواعد:
- ✅ **كل يوم حضور = +1 نقطة**
- ✅ **تتراكم يومياً**
- ✅ **عند الغياب = تُحذف جميع النقاط المتراكمة**
- ✅ **إذا لم يتم تسجيل بيانات = لا شيء**

### التطبيق:
- يتم إضافة نقطة واحدة تلقائياً عند تسجيل الحضور
- عند تسجيل الغياب، يتم حذف جميع نقاط الحماسة للطالب
- النقاط ظاهرة للطلاب والأساتذة والأدمن

### الملفات المتأثرة:
- `src/components/AttendanceEditor.tsx`
- `src/components/PointsSection.tsx`

---

## 2️⃣ النقاط العامة (General Points)

### القواعد:
- ✅ **يتحكم بها الأستاذ والأدمن**
- ✅ **زيادة أو نقصان حسب الحاجة**

### التطبيق:
- يمكن للأستاذ إضافة نقاط عامة من خلال واجهة إضافة العمل اليومي
- يمكن للأدمن إدارة النقاط من لوحة التحكم
- النقاط ظاهرة للطلاب والأساتذة والأدمن

### الملفات المتأثرة:
- `src/components/AddStudentWork.tsx`
- `src/pages/AdminPointsManagement.tsx`

---

## 3️⃣ نقاط الترتيب (Ranking Points) - وهمية للترتيب فقط

### القواعد:
- ✅ **مخفية عن الطلاب والأساتذة**
- ✅ **ظاهرة للأدمن فقط**
- ✅ **تُحسب شهرياً وليس يومياً**

### المنهجية:

#### أ) الأدب:
- **أدب كامل شهرياً (كل الأيام ممتاز) = +3 نقاط**
- **كل درجة نقص عن ممتاز = -2 نقطة**

#### ب) الغياب:
- **عدم الغياب شهرياً = +3 نقاط**
- **كل غياب = -1 نقطة**

#### ج) المذاكرة الشهرية (من 100):
- **علامة كاملة (100) = +3 نقاط**
- **كل نقص 10 = -1 نقطة**
- **الحد الأقصى للخصم = -3 نقاط (أقل من 70 = -3 فقط)**

#### د) التسميع:
- **لا نقاط عليه**

#### هـ) الاختبارات:
- **كل اختبار ليس إعادة = +3 نقاط**

### التطبيق:
- يتم حساب النقاط شهرياً باستخدام دالة SQL
- يمكن للأدمن تشغيل الحساب يدوياً أو تلقائياً
- النقاط تُستخدم فقط للترتيب الداخلي

### الملفات المتأثرة:
- `supabase/migrations/20251130000000_setup_ranking_points_system.sql`
- `src/lib/rankingPoints.ts`

---

## كيفية حساب نقاط الترتيب

### يدوياً (من SQL):
```sql
-- لطالب واحد في شهر معين
SELECT calculate_monthly_ranking_points(
  'student_id_here'::uuid,
  12,  -- الشهر
  2024 -- السنة
);

-- لجميع الطلاب في شهر معين
SELECT calculate_all_students_ranking_points(12, 2024);
```

### تلقائياً:
يمكن إعداد Cron Job لتشغيل الحساب تلقائياً في نهاية كل شهر.

---

## ملاحظات مهمة

1. **نقاط الحماسة** تُحسب يومياً وتتراكم
2. **النقاط العامة** يدوية بالكامل
3. **نقاط الترتيب** تُحسب شهرياً فقط
4. نقاط الترتيب **لا تظهر** للطلاب أو الأساتذة
5. التسميع **لا يؤثر** على نقاط الترتيب

---

## التحديثات الأخيرة

### التاريخ: 1 ديسمبر 2024

#### التغييرات:
1. ✅ تصحيح حساب نقاط الأدب ليكون شهرياً بدلاً من يومي
2. ✅ تصحيح حساب نقاط الغياب ليكون شهرياً بدلاً من يومي
3. ✅ تصحيح الحد الأقصى للخصم في المذاكرة الشهرية (-3 نقاط)
4. ✅ إزالة حساب نقاط الترتيب اليومي من AttendanceEditor
5. ✅ تحديث التوثيق في rankingPoints.ts

#### الملفات المعدلة:
- `src/lib/rankingPoints.ts`
- `src/components/AttendanceEditor.tsx`
- `supabase/migrations/20251130000000_setup_ranking_points_system.sql`
